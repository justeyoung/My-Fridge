<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Add Item to Fridge</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h2 class="title">Add Item to Fridge</h2>

  <div class="form-container">
    <button id="scanButton" class="button small-button">Scan Barcode</button>

    <label for="item">Item Name:</label>
    <input type="text" id="item" name="item" required />

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" name="quantity" value="1" min="1" />

    <label for="unit">Unit: <span class="optional">(optional)</span></label>
    <input type="text" id="unit" name="unit" />

    <label for="purchaseDate">Purchase Date:</label>
    <input type="date" id="purchaseDate" name="purchaseDate" />

    <label for="expiryDate">Expiry Date: <span class="optional">(optional)</span></label>
    <input type="date" id="expiryDate" name="expiryDate" />

    <label for="location">Location: <span class="optional">(optional)</span></label>
    <select id="location" name="location">
      <option value="">Select location</option>
      <option value="Freezer (garage)">Freezer (garage)</option>
      <option value="Freezer (dining room)">Freezer (dining room)</option>
      <option value="Fridge (kitchen)">Fridge (kitchen)</option>
      <option value="Fridge (dining room)">Fridge (dining room)</option>
    </select>

    <label for="barcode">Scanned Barcode:</label>
    <input type="text" id="barcode" name="barcode" disabled placeholder="(none)" />

    <button id="submit" class="button primary-button" disabled>Add Item</button>
    <button onclick="window.location.href='index.html'" class="button secondary-button">Home</button>

    <p id="status" class="status-message"></p>
  </div>

  <script>
    document.getElementById('purchaseDate').valueAsDate = new Date();

    const itemInput = document.getElementById('item');
    const quantityInput = document.getElementById('quantity');
    const submitButton = document.getElementById('submit');

    function updateButtonState() {
      submitButton.disabled = !itemInput.value.trim();
    }

    itemInput.addEventListener('input', updateButtonState);

    document.getElementById('submit').addEventListener('click', async () => {
      const item = itemInput.value.trim();
      const quantity = quantityInput.value || "1";

      if (!item) return;

      const unit = document.getElementById('unit').value.trim();
      const purchaseDate = document.getElementById('purchaseDate').value;
      const expiryDate = document.getElementById('expiryDate').value;
      const location = document.getElementById('location').value;
      const barcode = document.getElementById('barcode').value;

      const params = new URLSearchParams({
        item, quantity, unit, purchaseDate, expiryDate, location, barcode
      });

      const status = document.getElementById('status');
      status.textContent = 'Adding item...';

      try {
        await fetch('https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?' + params.toString());
        status.textContent = 'Item added successfully.';
        setTimeout(() => status.textContent = '', 5000);

        // Reset fields
        itemInput.value = '';
        quantityInput.value = '1';
        document.getElementById('unit').value = '';
        document.getElementById('expiryDate').value = '';
        document.getElementById('location').value = '';
        document.getElementById('barcode').value = '';
        updateButtonState();
      } catch (err) {
        status.textContent = 'Error adding item.';
        console.error(err);
      }
    });

    document.getElementById('scanButton').addEventListener('click', () => {
      window.location.href = 'scanner.html';
    });
  </script>
</body>
</html>
