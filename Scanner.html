<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Add Item to Fridge</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h2>Add Item to Fridge</h2>

  <button class="scan-button" onclick="startScan()">Scan Barcode</button>

  <div class="form-container">
    <label for="itemName">Item Name:</label>
    <input type="text" id="itemName" required />

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" value="1" min="1" />

    <label for="unit">Unit: <small>(optional)</small></label>
    <input type="text" id="unit" />

    <label for="purchaseDate">Purchase Date:</label>
    <input type="date" id="purchaseDate" />

    <label for="expiryDate">Expiry Date: <small>(optional)</small></label>
    <input type="date" id="expiryDate" />

    <label for="location">Location: <small>(optional)</small></label>
    <select id="location">
      <option value="">Select location</option>
      <option value="Freezer (garage)">Freezer (garage)</option>
      <option value="Freezer (dining room)">Freezer (dining room)</option>
      <option value="Fridge (dining room)">Fridge (dining room)</option>
      <option value="Fridge (kitchen)">Fridge (kitchen)</option>
    </select>

    <label>Scanned Barcode:</label>
    <div class="readonly-barcode" id="scannedBarcodeDisplay">(none)</div>

    <button class="add-button" onclick="submitForm()">Add Item</button>
    <div id="statusMessage"></div>
    <button class="home-button" onclick="location.href='index.html'">Home</button>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyThkEhW3QIAIZcXhgvc5bfDgwZ8TG7wZqley13fHAqreh9FnohK37jcfPx8HlHgRXD/exec';
    let scannedBarcodeValue = "";

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("purchaseDate").valueAsDate = new Date();
    });

    function startScan() {
      window.location.href = "scan.html";
    }

    // Load barcode from sessionStorage (if previously scanned)
    if (sessionStorage.getItem("barcode")) {
      scannedBarcodeValue = sessionStorage.getItem("barcode");
      document.getElementById("scannedBarcodeDisplay").textContent = scannedBarcodeValue;
      sessionStorage.removeItem("barcode");
    }

    function submitForm() {
      const item = document.getElementById("itemName").value.trim();
      const quantity = document.getElementById("quantity").value;
      const unit = document.getElementById("unit").value.trim();
      const purchaseDate = document.getElementById("purchaseDate").value;
      const expiryDate = document.getElementById("expiryDate").value;
      const location = document.getElementById("location").value;
      const barcode = scannedBarcodeValue;
      const statusMessage = document.getElementById("statusMessage");

      if (!item) {
        statusMessage.textContent = "Item name is required.";
        statusMessage.style.color = "red";
        return;
      }

      const formData = new URLSearchParams({
        action: "add",
        item,
        quantity,
        unit,
        purchaseDate,
        expiryDate,
        location,
        barcode,
        notes: ""
      });

      fetch(scriptURL, {
        method: "POST",
        body: formData
      })
      .then(response => response.text())
      .then(result => {
        statusMessage.textContent = result;
        statusMessage.style.color = "green";

        // Clear form
        document.getElementById("itemName").value = "";
        document.getElementById("quantity").value = "1";
        document.getElementById("unit").value = "";
        document.getElementById("purchaseDate").valueAsDate = new Date();
        document.getElementById("expiryDate").value = "";
        document.getElementById("location").selectedIndex = 0;
        scannedBarcodeValue = "";
        document.getElementById("scannedBarcodeDisplay").textContent = "(none)";

        // Clear status after 5 sec
        setTimeout(() => {
          statusMessage.textContent = "";
        }, 5000);
      })
      .catch(error => {
        statusMessage.textContent = "Error adding item.";
        statusMessage.style.color = "red";
        setTimeout(() => {
          statusMessage.textContent = "";
        }, 5000);
      });
    }
  </script>
</body>
</html>
